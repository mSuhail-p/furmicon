<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Category</title>

    <!-- Include Bootstrap CSS (choose either local or CDN link) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>

<body style="background: rgb(153, 153, 152);">

    <div class="container mt-5 w-50 border border-2 bg-white rounded-4   ">
        <h3 class="text-center mb-4  ">Edit Category</h3>
        <form>
            <!-- Name field -->

            <% if (editCategory){ %>

                <style>
                    .error-message {
                        display: none;
                        /* Initially hide the error message */
                        color: red;
                        /* Customize the color of the error message */
                        font-size: 0.8rem;
                        /* Customize the font size of the error message */
                        margin-top: 0.2rem;
                        /* Add some space between the input and the error message */
                    }
                </style>





                <div class="mb-3">
                    <label for="name" class="form-label  ">Name:</label>
                    <input type="text" id="name" name="name" value="<%= editCategory.name %>"
                        class="form-control border-black border-3" required>
                    <div id="errorMessage" class="error-message"></div>
                </div>

                <!-- Description field -->
                <div class="mb-3">
                    <label for="description" class="form-label  ">Description:</label>
                    <textarea id="description" name="description" rows="4" class="form-control  border-black border-3"
                        required><%= editCategory.description %></textarea>
                </div>

                <!-- Submit button -->
                <button type="submit" class="btn btn-primary  border-black border-2 mb-3 "
                    onclick="is_duplecate(event, '<%= editCategory._id %>')">Submit</button>

                <input type="hidden" name="id" value="<%=editCategory._id %>">
        </form>
    </div>

    <% } %>

        <!-- Include Bootstrap JS (choose either local or CDN link) -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-pzjw8W+8ML/LUEHI5ts7ZLxFWh1bSquyXvs1qKH/cz5EML5Z8eqt1OKtLqca/8aQ"
            crossorigin="anonymous"></script>

        <script>

            function is_duplecate(event, editCategory_id) {
                event.preventDefault();
                // const button = document.getElementById(`toggleCategory_${index}`);

                const formData = {
                    name: document.getElementById('name').value,
                    description: document.getElementById('description').value,
                    id: editCategory_id

                }

                const errorMessage = document.getElementById('name')

                fetch(`/admin/editingCategory/${editCategory_id}`, {


                    method: 'PUT',
                    headers: {
                        'content-type': 'application/json'
                    },
                    body: JSON.stringify(formData)

                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.message !== 'existing') {
                            window.location.href = data.message
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'The category name is currently in use.',
                                text: 'Use unique one '
                            });
                        }

                    })
                    .catch(error => {
                        console.error('Errorrrr:', error);
                    });
            }





        </script>

</body>

</html>